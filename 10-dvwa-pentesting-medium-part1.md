## Objective
Re-attempt the DVWA challenges on the medium level this time, where some vulnerabilities have been patched. 

___
## SQL Injection
### Behavior
At Medium difficulty, DVWA restricts input to a dropdown menu instead of a free text field.  

![[10_1.png]]
- When I select and submit an `id` number, the url does not reveal any parameters.
- Exploiting this vulnerability requires intercepting and tampering with requests using a web proxy tool like Burp Suite. 
### Attack Steps
- Configured Firefox to proxy HTTP/HTTPS through Burp (127.0.0.1:8080)
- Logged into DVWA and navigated to the SQL Injection module
- Enabled **Intercept** under Burp Suite's Proxy tab
- Submitted a valid user ID from the dropdown
- Burp Suite intercepted a POST request
	- **SQL commands will go into the value of `id`**

![[10_2.png]]
#### Payloads
To try each payload, I edited the request text in Burp Suite then clicked the `Forward` button.

**`id=' OR '1'='1
- Meaning: always true conditional
- Result: blank screen from error, however this worked on the low difficulty.
	- This time, quotes may be escaped in the backend query 
	- Entering the payload results in an invalid query like
```sql
SELECT first_name, last_name FROM users WHERE id=\' OR \'1\'=\'1\';
```

![[10_3.png]]

**`id=1 OR 1=1-- 
- Meaning: always true conditional and comment out the rest
- Result: returned all of the users' first and last names (success)

![[10_4.png]]

**`id=1 UNION SELECT user,password FROM users--
- Meaning: return the first user with `id=1` to keep the query valid, then return the username and password columns
- Result: displayed of all the plaintext usernames and hashed passwords (success)
	- Common passwords can be cracked and we can see from the hashes that `admin` and `smithy` have the same password

![[10_5.png]]

### Detection 
#### Wireshark
Query used:
```
http.request.method == "POST"
```
We can view the parameters of the tampered POST requests by double clicking on a HTTP POST packet. The SQL command appears under `HTML Form URL Encoded.

![[10_6.png]]

___
### XSS (Reflected)
### Behavior
Like in the low difficulty, this module shows the message "Hello" followed by a space and the string entered into the text field.

![[10_7.png]]

### Payloads
**`<script>alert(1)</script>
- Meaning: basic alert with message "1"
- Result: did not execute the script or trigger a pop up like it did in Low difficulty. 
	- Only printed the `alert(1)` from the payload, indicating some level of input sanitization.

![[10_8.png]]

**`<img src=x onerror=alert(1)>`**
- Meaning: alert triggered by an image error
- Result: triggered a pop-up with message "1" (like the previous payload), then showed an image icon on the page when the alert was dismissed. Also worked in Low difficulty mode.
	- `<script>` was probably blacklisted, but other tags weren't

![[10_9.png]]![[10_10.png]]

___
### Brute Force
Like in Low difficulty, the username and password are in the GET query string as they show up in the url. 

![[10_11.png]]

### Attack Steps
- To save time, I made a sub-list of the first 500 passwords in rockyou.txt with 
 ```
head -n 500 /usr/share/wordlists/rockyou.txt > rockyou-500.txt
   ```
- Logged into DVWA and navigated to the Brute Force module
- Enabled **Intercept** under Burp Suite's Proxy tab
- Submitted a test login on the DVWA brute force form
- Intercepted a GET request containing credentials in the URL
- Sent captured request to **Intruder**
- Set the payload position to the password field

![[10_12.png]]
- Selected Sniper attack type
- Loaded in `rockyou-500.txt`

### Result
- All failed attempts returned length 4953 (with a few 4952 at the beginning) which can be confirmed by sorted the Length column
- The correct password `password` returned length 4996 with a welcome message 
- The attack ran as quickly as it did on Low level, indicating no delay or lockout after many failed attempts

![[10_13.png]]

___
Next steps: review source code for low and medium DVWA.
